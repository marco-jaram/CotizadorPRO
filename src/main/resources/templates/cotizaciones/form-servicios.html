<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.w3.org/1999/xhtml">

<head th:replace="~{fragments/header :: header}"></head>

<body>
<div class="container">


<nav th:replace="~{fragments/common :: navbar}" ></nav>
<div layout:fragment="content">
    <div class="card">
        <div class="card-header">
            <h3><i class="bi bi-tools"></i> Nueva Cotización de Servicios</h3>
        </div>
        <div class="card-body">
            <form th:action="@{/cotizaciones/servicios}" th:object="${cotizacion}" method="post">
                <h4>Datos Generales</h4>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="clienteId" class="form-label">Cliente</label>
                        <select id="clienteId" name="clienteId" class="form-select" required>
                            <option value="">Seleccione un cliente...</option>
                            <option th:each="cliente : ${clientes}" th:value="${cliente.id}" th:text="${cliente.nombreEmpresa}"></option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="vendedor" class="form-label">Vendedor (Mi Empresa)</label>
                        <input type="text" class="form-control" id="vendedor" th:value="${vendedor.nombreEmpresa}" readonly disabled>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="vigencia" class="form-label">Vigencia</label>
                        <input type="text" id="vigencia" name="vigencia" class="form-control" th:field="*{vigencia}" placeholder="Ej: 15 días">
                    </div>
                    <div class="col-md-6">
                        <label for="formaPago" class="form-label">Forma de Pago</label>
                        <input type="text" id="formaPago" name="formaPago" class="form-control" th:field="*{formaPago}" placeholder="Ej: 50% Anticipo, 50% Contra-entrega">
                    </div>
                </div>

                <hr>
                <h4>Conceptos del Servicio</h4>
                <div id="lineas-container">
                    <!-- Las líneas se añadirán aquí dinámicamente -->
                </div>
                <button type="button" id="addLinea" class="btn btn-success mt-2"><i class="bi bi-plus-circle"></i> Añadir Concepto</button>
                <hr>
                <h4>Términos y Condiciones</h4>
                <div class="mb-3">
                    <label for="descripcionGeneral" class="form-label">Descripción General del Servicio</label>
                    <textarea id="descripcionGeneral" name="descripcionGeneral" th:field="*{descripcionGeneral}" class="form-control" rows="3"></textarea>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="metodosAceptados" class="form-label">Métodos de Pago Aceptados</label>
                        <input type="text" id="metodosAceptados" name="metodosAceptados" class="form-control" th:field="*{metodosAceptados}" placeholder="Ej: Transferencia, Tarjeta de Crédito">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="condicionesEntrega" class="form-label">Condiciones de Entrega</label>
                        <input type="text" id="condicionesEntrega" name="condicionesEntrega" class="form-control" th:field="*{condicionesEntrega}" placeholder="Ej: Según calendario acordado">
                    </div>
                </div>

                <div class="mt-4">
                    <button type="submit" class="btn btn-primary btn-lg">Crear Cotización</button>
                    <a th:href="@{/}" class="btn btn-secondary btn-lg">Cancelar</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let lineaIndex = 0;
            const container = document.getElementById('lineas-container');
            const addButton = document.getElementById('addLinea');

            function addLinea() {
                const div = document.createElement('div');
                div.className = 'row align-items-end mb-2 linea-item';
                div.innerHTML = `
                    <div class="col-md-4">
                        <label class="form-label">Concepto</label>
                        <input type="text" name="lineas[${lineaIndex}].concepto" class="form-control" required>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Cantidad</label>
                        <input type="number" step="any" name="lineas[${lineaIndex}].cantidad" class="form-control" value="1" required>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Unidad</label>
                        <input type="text" name="lineas[${lineaIndex}].unidad" class="form-control" value="Servicio" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Precio Unitario</label>
                        <input type="number" step="0.01" name="lineas[${lineaIndex}].precioUnitario" class="form-control" required>
                    </div>
                    <div class="col-md-1">
                        <button type="button" class="btn btn-danger remove-linea"><i class="bi bi-trash"></i></button>
                    </div>
                `;
                container.appendChild(div);
                lineaIndex++;
            }

            addButton.addEventListener('click', addLinea);

            container.addEventListener('click', function (e) {
                if (e.target.closest('.remove-linea')) {
                    e.target.closest('.linea-item').remove();
                }
            });

            // Añadir una línea inicial
            addLinea();
        });
    </script>
</div>
</div>
</body>
</html>