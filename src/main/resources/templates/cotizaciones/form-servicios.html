<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Nueva Cotización de Servicios</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<div th:replace="~{_fragments :: navbar}"></div>

<div class="container mt-4">
    <h2>Nueva Cotización de Servicios</h2>
    <hr/>
    <form th:action="@{/cotizaciones/servicios}" th:object="${cotizacion}" method="post">
        <!-- SECCIÓN 1: DATOS GENERALES -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>1. Datos Generales</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="clienteId" class="form-label">Cliente <span class="text-danger">*</span></label>
                        <select id="clienteId" class="form-select" th:field="*{clienteId}" required>
                            <option value="">Seleccione un cliente...</option>
                            <option th:each="emp : ${clientes}" th:value="${emp.id}" th:text="${emp.nombreEmpresa}"></option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="vendedorId" class="form-label">Vendedor (Su Empresa) <span class="text-danger">*</span></label>
                        <select id="vendedorId" class="form-select" th:field="*{vendedorId}" required>
                            <option value="">Seleccione un vendedor...</option>
                            <option th:each="emp : ${vendedores}" th:value="${emp.id}" th:text="${emp.nombreEmpresa}"></option>
                        </select>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="vigencia" class="form-label">Vigencia</label>
                    <input type="text" class="form-control" id="vigencia" th:field="*{vigencia}" placeholder="Ej: Válido por 15 días naturales" required>
                </div>
                <div class="mb-3">
                    <label for="descripcionGeneral" class="form-label">Descripción General del Servicio</label>
                    <textarea class="form-control" id="descripcionGeneral" th:field="*{descripcionGeneral}" rows="3" placeholder="Explique en qué consiste el servicio..."></textarea>
                </div>
            </div>
        </div>

        <!-- SECCIÓN 2: CONCEPTOS A COTIZAR -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>2. Conceptos a Cotizar</h5>
            </div>
            <div class="card-body">
                <table class="table table-bordered" id="lineas-servicios-table">
                    <thead>
                    <tr>
                        <th style="width: 50%;">Concepto</th>
                        <th>Cantidad</th>
                        <th>Unidad</th>
                        <th>Precio Unitario</th>
                        <th>Acción</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- Las filas se añadirán aquí con JavaScript -->
                    </tbody>
                </table>
                <button type="button" class="btn btn-success btn-sm" onclick="agregarLinea()">
                    <i class="fas fa-plus"></i> Agregar Concepto
                </button>
            </div>
        </div>

        <!-- SECCIÓN 3: TÉRMINOS OPERATIVOS -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>3. Términos Operativos</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3"><label for="formaPago" class="form-label">Forma de Pago</label><input type="text" class="form-control" id="formaPago" th:field="*{formaPago}" placeholder="Ej: 50% anticipado, 50% al finalizar"></div>
                    <div class="col-md-6 mb-3"><label for="metodosAceptados" class="form-label">Métodos de Pago Aceptados</label><input type="text" class="form-control" id="metodosAceptados" th:field="*{metodosAceptados}" placeholder="Ej: Transferencia, Tarjeta"></div>
                    <div class="col-md-6 mb-3"><label for="condicionesEntrega" class="form-label">Condiciones de Entrega</label><input type="text" class="form-control" id="condicionesEntrega" th:field="*{condicionesEntrega}" placeholder="Ej: Entregable final, Hitos semanales"></div>
                    <div class="col-md-6 mb-3"><label for="tiempoRespuesta" class="form-label">Tiempo de Ejecución/Respuesta</label><input type="text" class="form-control" id="tiempoRespuesta" th:field="*{tiempoRespuesta}" placeholder="Ej: Inicio en 5 días hábiles tras pago"></div>
                </div>
            </div>
        </div>

        <hr/>
        <button type="submit" class="btn btn-primary btn-lg">Crear Cotización</button>
        <a th:href="@{/}" class="btn btn-secondary btn-lg">Cancelar</a>
    </form>
</div>

<script>
    let lineaIndex = 0;
    function agregarLinea() {
        const tableBody = document.getElementById('lineas-servicios-table').getElementsByTagName('tbody')[0];
        const newRow = tableBody.insertRow();
        newRow.innerHTML = `
            <td><input type="text" name="lineas[${lineaIndex}].concepto" class="form-control" required/></td>
            <td><input type="number" name="lineas[${lineaIndex}].cantidad" class="form-control" step="0.01" value="1" required/></td>
            <td><input type="text" name="lineas[${lineaIndex}].unidad" class="form-control" placeholder="Ej: Hora, Pieza" required/></td>
            <td><input type="number" name="lineas[${lineaIndex}].precioUnitario" class="form-control" step="0.01" placeholder="0.00" required/></td>
            <td class="text-center"><button type="button" class="btn btn-danger btn-sm" onclick="this.closest('tr').remove()"><i class="fas fa-trash"></i></button></td>
        `;
        lineaIndex++;
    }
    // Añadir una línea por defecto al cargar la página
    window.onload = agregarLinea;
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>